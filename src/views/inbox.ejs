<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Sumit Saha" />
    <meta name="owner" content="learnwithsumit.com" />
    <title>Inbox</title>

    <!-- FontAwesome 6 CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <link rel="shortcut icon" href="/images/favicon.png" />
    <!-- <link rel="stylesheet" href="./stylesheets/toastify.css" /> -->
    <link rel="stylesheet" href="/css/style.css" />
    <!-- <script src="./js/toastify.js"></script> -->
  </head>
  <body>
    <div class="menu">
      <div class="menu-item"><a href="/inbox">Inbox</a></div>
      <div class="menu-item"><a href="/users">Users</a></div>
      <div class="menu-item"><a href="/logout">LogOut</a></div>
    </div>
    <div id="chat-container">
      <div id="search-container">
        <input type="text" placeholder="Search" id="search-input"/>
        <div class="searchResults" id="search-results" style="display: none;">
          <!-- search result sample user list -->
          <!-- <div class="conversation searchResultUser" >
            <img src="./images/user1.png" alt="Sumit" />
            <div class="title-text">User Name</div>
            <di class="created-date messageBtn"> <i class="fa-solid fa-message"></i> </di>
            <div class="conversation-message">No message</div>
          </div> -->
        </div>
      </div>

      <div id="conversation-list">
        <div class="conversation active">
          <img src="./images/user1.png" alt="Sumit" />
          <div class="title-text">Sumit Saha</div>
          <di class="created-date"> Apr 16 </di>
          <div class="conversation-message">This is a message</div>
        </div>
        <div class="conversation">
          <img src="./images/user2.png" alt="Sumit" />
          <div class="title-text">Sumit Saha</div>
          <di class="created-date"> Apr 16 </di>
          <div class="conversation-message">This is a message</div>
        </div>
      </div>
      <div id="new-message-container">
        <a href="#">+</a>
      </div>
      <div id="chat-title">
        <span> <%= user.username %> </span>
        <img src="./images/trash.png" alt="Delete Conversation" />
      </div>
      <div id="chat-message-list">
        <div class="message-row other-message">
          <div class="message-content">
            <img src="./images/user1.png" alt="Sumit" />
            <div class="message-text">Ok then</div>
            <div class="message-time">Apr 16</div>
          </div>
        </div>
        <div class="message-row you-message">
          <div class="message-content">
            <div class="message-text">Lorem ipsum dolor sit amet</div>
            <div class="message-time">Apr 16</div>
          </div>
        </div>
      </div>
      <div id="chat-form">
        <img src="./images/attachment.png" alt=Add Attachment"" />
        <input type="text" placeholder="Type a message" />
      </div>
    </div>

    <div class="modal-wrapper">
      <div class="modal">
        <a href="#" class="modal-close">+</a>
        <div class="modal-title">
          <h2>Create New Conversation</h2>
        </div>
        <div class="modal-body">
          <form>
            <input type="text" placeholder="Name" />
            <input type="text" placeholder="Username" />
            <input type="button" value="Submit" />
          </form>
        </div>
      </div>
    </div>

    <script>
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
    
      searchInput.addEventListener('input', async (event) => {
        const query = event.target.value.trim();

    
        if (query.length === 0) {
          searchResults.style.display = 'none';
          searchResults.innerHTML = '';
          return;
        }
    
        try {
          const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
          const users = await response.json();
    
          // Clear previous results
          searchResults.innerHTML = '';
          searchResults.style.display = users.length ? 'block' : 'none';

          searchResults.innerHTML = users.length ? '<h3>Search results..</h3>': '';
    
          // Render each user in the search results
          users.forEach((user) => {
            const userElement = document.createElement('div');
            userElement.classList.add('conversation', 'searchResultUser');
    
            userElement.innerHTML = `
              <img src="${user.avatar || '/images/user1.png'}" alt="${user.username}" />
              <div class="title-text">${user.username}</div>
              <div class="created-date messageBtn">
                <i class="fa-solid fa-message"></i>
              </div>
              <div class="conversation-message">${user.email}</div>
            `;
    
            searchResults.appendChild(userElement);
          });
        } catch (error) {
          console.error('Search error:', error);
        }
      });
    </script>
    
  </body>
</html>
